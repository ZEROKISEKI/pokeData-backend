import app from '../app'
import http from 'http'
import pbjs from 'protobufjs/cli/pbjs'
import ora from 'ora'
import {proto} from '../config'

const server = http.createServer(app.callback())
const spinner = ora('building proto model...\n').start()

// const testServer = http.createServer(app.callback())

pbjs.main(...proto, (err, output) => {
	if (err) spinner.fail('building proto failed! check your *.proto file!\n')
	else {
		spinner.succeed('build proto model success!\n')
		server.listen(3006)
	}
})

// testServer.listen(3007)

export default server